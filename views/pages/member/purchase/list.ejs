<!DOCTYPE html>
<html>
  <head>
    <%- include(__base + 'views/partials/head.ejs') %>
  </head>
  <body>

    <!-- Navbar -->
    <%- include(__base + 'views/partials/navbar-purchase.ejs') %>
    <header>
      <div class="container-fluid">
        <ul class="list-group black-text" id="purchases">
        </ul>
      </div>
    </header>

    <%- include(__base + 'views/partials/js-include.ejs') %>
    <script>
      function addToList(purchases) {
        if (typeof purchases !== 'object') {
          console.log('error: addToList takes an object as a parameter')
          return
        }
        for (var purchase_id in purchases) {
          var purchase = purchases[purchase_id]
          $("#purchases").append(""
            + '<li class="list-group-item">'
            +   purchase.vendor + " (" + purchase.submitted_by + ")"
            +   '<a href="view/' + purchase_id + '" class="btn btn-default btn-xs float-right">View</a>'
            +   (purchase.submitted_by === "<%- auth.loggedin ? auth.info.email : notpossible %>" ? '<a href="edit/' + purchase_id + '" class="btn btn-default btn-xs float-right">Edit</a>' : "")
            + '</li>'
          )
        }
      }
      function error() {
        $("#purchases").append('<li class="list-group-item">There was an error</li>')
      }
      $.ajax({
        method: "GET",
        url: '/member/purchase/list_object/<%- (filter ? filter : "") %>',
        success: function(data) { addToList(data) },
        error: function(err1, err2, err3) { console.log(err1, err2, err3); error()  }
      })
    </script>

  </body>
</html>
